!function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)}([function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return o});var o=(r(i.prototype,[{key:"_updateToken",value:function(e){this.token="Bearer ".concat(e)}},{key:"_postRequestSignup",value:function(e,t,n,r,o){return fetch(this.config+e,{method:t,headers:{"Content-Type":"application/json",Authorization:this.token},body:JSON.stringify({email:n,password:r,name:o})})}},{key:"_postRequestSignin",value:function(e,t,n,r){return fetch(this.config+e,{method:t,credentials:"include",headers:{"Content-Type":"application/json",Authorization:this.token},body:JSON.stringify({email:n,password:r})})}},{key:"_getRequestUser",value:function(e,t){return fetch(this.config+e,{method:t,credentials:"include",headers:{Authorization:this.token}})}},{key:"_getRequestAllGifts",value:function(e,t){return fetch(this.config+e,{method:t,credentials:"include",headers:{Authorization:this.token}})}},{key:"_postRequestCreateGift",value:function(e,t,n,r,o){return fetch(this.config+e,{method:t,credentials:"include",headers:{"Content-Type":"application/json",Authorization:this.token},body:JSON.stringify({name:n,competence:r,comment:o})})}},{key:"_postRequestBuyGift",value:function(e,t,n,r){return fetch(this.config+e,{method:t,credentials:"include",headers:{"Content-Type":"application/json",Authorization:this.token},body:JSON.stringify({takeGift:n,address:r})})}},{key:"signup",value:function(e,t,n){return this._postRequestSignup("/signup","POST",e,t,n)}},{key:"signin",value:function(e,t){return this._postRequestSignin("/signin","POST",e,t)}},{key:"getUser",value:function(){return this._getRequestUser("/users/me","GET")}},{key:"giftStar",value:function(e,t,n){return this._postRequestCreateGift("/donats","POST",e,t,n)}},{key:"buyGift",value:function(e,t,n){return this._postRequestBuyGift("/gifts/buy/"+n,"POST",e,t)}},{key:"getAllGifts",value:function(){return this._getRequestUser("/gifts/all","GET")}}]),i);function i(e,t){!function(e){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this),this.config=e,this.token="Bearer ".concat(t)}},function(e,t,n){var r,o;void 0===(r="function"==typeof(r=o=function(){function a(){for(var e=0,t={};e<arguments.length;e++){var n,r=arguments[e];for(n in r)t[n]=r[n]}return t}function c(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function e(u){function s(){}function n(e,t,n){if("undefined"!=typeof document){"number"==typeof(n=a({path:"/"},s.defaults,n)).expires&&(n.expires=new Date(+new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var r=JSON.stringify(t);/^[\{\[]/.test(r)&&(t=r)}catch(e){}t=u.write?u.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o,i="";for(o in n)n[o]&&(i+="; "+o,!0!==n[o]&&(i+="="+n[o].split(";")[0]));return document.cookie=e+"="+t+i}}function t(e,t){if("undefined"!=typeof document){for(var n={},r=document.cookie?document.cookie.split("; "):[],o=0;o<r.length;o++){var i=r[o].split("="),s=i.slice(1).join("=");t||'"'!==s.charAt(0)||(s=s.slice(1,-1));try{var a=c(i[0]),s=(u.read||u)(s,a)||c(s);if(t)try{s=JSON.parse(s)}catch(e){}if(n[a]=s,e===a)break}catch(e){}}return e?n[e]:n}}return s.set=n,s.get=function(e){return t(e,!1)},s.getJSON=function(e){return t(e,!0)},s.remove=function(e,t){n(e,"",a(t,{expires:-1}))},s.defaults={},s.withConverter=e,s}(function(){})})?r.call(t,n,t,e):r)||(e.exports=r),e.exports=o()},,function(e,t,n){"use strict";n.r(t);var r=n(0);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=(o(a.prototype,[{key:"_validateInputElement",value:function(e,t){return e.validity.valueMissing?t.textContent=this.errors.requiredText:e.validity.typeMismatch?t.textContent=this.errors.requiredEmail:"password"===e.name&&e.validity.tooShort?t.textContent=this.errors.validationLengthPass:t.textContent=""}},{key:"_validateForm",value:function(e,t){t.disabled=!e.checkValidity(),e.checkValidity()?t.classList.remove("form__button_off"):t.classList.add("form__button_off")}},{key:"setEventListeners",value:function(t){var n=this,r=t.querySelector(".form__button");t.addEventListener("input",function(e){n._validateInputElement(e.target,e.target.closest(".form__wrapper").querySelector(".form__error")),n._validateForm(t,r)})}},{key:"setServerError",value:function(e,t){e.textContent=t}}]),a),t=n(1),s=n.n(t);function a(e){!function(e){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this),this.errors=e}function u(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function c(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?u(Object(o),!0).forEach(function(e){var t,n;t=r,e=o[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}var l=JSON.parse(localStorage.getItem("userData")),f=document.querySelector(".popup__signup"),d=document.querySelector(".popup__gift"),p=document.querySelector(".signin"),m=document.querySelector(".signup"),t=document.querySelector("header"),v=document.querySelector(".gift"),_=v.querySelectorAll("option"),y=v.querySelector(".gift__stars span"),h=t.querySelector(".header__rules"),g=t.querySelector(".header__intro"),S=t.querySelector(".header__name"),b=p.querySelector("form"),w=m.querySelector("form"),k=v.querySelector("form"),L=new r.a("http://193.110.3.88:3012",null==l?void 0:l.token),i=new i({validationLengthPass:"Должно быть не менее 5 символов",requiredText:"Это обязательное поле",requiredEmail:"Здесь должна быть электронная почта",selectInList:"Нужно сделать выбор!"},w,b);l&&(p.classList.add("signin_off"),m.classList.add("signup_off"),v.classList.remove("gift_off"),h.classList.remove("header__rules_off"),g.classList.add("header__intro_off"),p.querySelector(".form__server-error").textContent=""),i.setEventListeners(w),i.setEventListeners(b),i.setEventListeners(k),document.addEventListener("click",function(e){e.target.classList.contains("form__span_signup")&&(p.classList.remove("signin_off"),m.classList.add("signin_off")),e.target.classList.contains("form__span_signin")&&(p.classList.add("signin_off"),m.classList.remove("signin_off")),e.target.classList.contains("popup__close")&&(f.classList.remove("popup_on"),d.classList.remove("popup_on")),e.target.classList.contains("gift__logout-span")&&(s.a.remove("jwt","localhost"),localStorage.removeItem("userData"),window.location.reload())}),w.addEventListener("submit",function(e){m.querySelector(".form__server-error").textContent="",L.signup(w.elements.email.value,w.elements.password.value,w.elements.name.value).then(function(e){if(e.ok&&f.classList.add("popup_on"),409===e.status)throw new Error("Пользователь с такой электронной почтой уже существует");if(500===e.status)throw new Error("Ошибка на сервере");return e.json()}).catch(function(e){m.querySelector(".form__server-error").textContent=e}),w.elements.email.value="",w.elements.password.value="",e.preventDefault()}),b.addEventListener("submit",function(e){L.signin(b.elements.email.value,b.elements.password.value).then(function(e){if(e.ok&&(p.classList.add("signin_off"),m.classList.add("signup_off"),v.classList.remove("gift_off"),h.classList.remove("header__rules_off"),g.classList.add("header__intro_off"),p.querySelector(".form__server-error").textContent=""),401===e.status)throw new Error("Неправильные почта или пароль");if(500===e.status)throw new Error("Ошибка на сервере");return e.json()}).then(function(e){localStorage.setItem("userData",JSON.stringify(e)),L._updateToken(e.token);var t=e.name.split(" ");S.textContent=t[0],y.textContent=e.starsToGiftQuantity;for(var n=0;n<_.length;n++)_[n].innerHTML==e.name&&_[n].remove()}).catch(function(e){p.querySelector(".form__server-error").textContent=e}),e.preventDefault()}),L.getUser().then(function(e){if(e.ok&&(p.classList.add("signin_off"),m.classList.add("signup_off"),v.classList.remove("gift_off"),h.classList.remove("header__rules_off"),g.classList.add("header__intro_off")),500===e.status)throw new Error("Ошибка на сервере");if(404===e.status)throw new Error("Ошибка 404");if(401===e.status)throw new Error("Требуется аутентификация");return e.json()}).then(function(e){var t=e.user.name.split(" ");S.textContent=t[0],y.textContent=e.user.starsToGiftQuantity;for(var n=0;n<_.length;n++)_[n].innerHTML==e.user.name&&_[n].remove();localStorage.setItem("userData",JSON.stringify(c(c({},l),{},{starsToGiftQuantity:e.user.starsToGiftQuantity})))}).catch(function(e){console.log(e)}),k.addEventListener("submit",function(e){return 0==y.textContent?(e.preventDefault(),v.querySelector(".form__server-error").textContent="К сожалению, у Вас закончились звезды :("):(L.giftStar(k.elements.name.value,k.elements.competence.value,k.elements.comment.value).then(function(e){return e.ok&&(d.classList.add("popup_on"),k.elements.comment.value="",v.querySelector(".form__server-error").textContent=""),e.json()}).then(function(e){e.error?v.querySelector(".form__server-error").textContent=e.error:(e=Number(y.textContent)-1,y.textContent=e)}).catch(function(e){v.querySelector(".form__server-error").textContent=e}),void e.preventDefault())})}]);