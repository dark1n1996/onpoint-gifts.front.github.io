!function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=2)}([function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return o});var o=(r(s.prototype,[{key:"_updateToken",value:function(e){this.token="Bearer ".concat(e)}},{key:"_postRequestSignup",value:function(e,t,n,r,o){return fetch(this.config+e,{method:t,headers:{"Content-Type":"application/json",Authorization:this.token},body:JSON.stringify({email:n,password:r,name:o})})}},{key:"_postRequestSignin",value:function(e,t,n,r){return fetch(this.config+e,{method:t,credentials:"include",headers:{"Content-Type":"application/json",Authorization:this.token},body:JSON.stringify({email:n,password:r})})}},{key:"_getRequestUser",value:function(e,t){return fetch(this.config+e,{method:t,credentials:"include",headers:{Authorization:this.token}})}},{key:"_getRequestAllGifts",value:function(e,t){return fetch(this.config+e,{method:t,credentials:"include",headers:{Authorization:this.token}})}},{key:"_postRequestCreateGift",value:function(e,t,n,r,o){return fetch(this.config+e,{method:t,credentials:"include",headers:{"Content-Type":"application/json",Authorization:this.token},body:JSON.stringify({name:n,competence:r,comment:o})})}},{key:"_postRequestBuyGift",value:function(e,t,n,r){return fetch(this.config+e,{method:t,credentials:"include",headers:{"Content-Type":"application/json",Authorization:this.token},body:JSON.stringify({takeGift:n,address:r})})}},{key:"signup",value:function(e,t,n){return this._postRequestSignup("/signup","POST",e,t,n)}},{key:"signin",value:function(e,t){return this._postRequestSignin("/signin","POST",e,t)}},{key:"getUser",value:function(){return this._getRequestUser("/users/me","GET")}},{key:"giftStar",value:function(e,t,n){return this._postRequestCreateGift("/donats","POST",e,t,n)}},{key:"buyGift",value:function(e,t,n){return this._postRequestBuyGift("/gifts/buy/"+n,"POST",e,t)}},{key:"getAllGifts",value:function(){return this._getRequestUser("/gifts/all","GET")}}]),s);function s(e,t){!function(e){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}(this),this.config=e,this.token="Bearer ".concat(t)}},,function(e,t,n){"use strict";n.r(t);n=n(0);function s(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function r(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?s(Object(o),!0).forEach(function(e){var t,n;t=r,e=o[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}var o,i=document.querySelector(".shop"),a=(i.querySelectorAll(".shop-card"),i.querySelector(".shop-cards")),c=i.querySelector(".shop-header__name"),u=JSON.parse(localStorage.getItem("userData")),l=new n.a("http://193.110.3.88:3012",null==u?void 0:u.token),f=i.querySelector(".shop__stars-quantity span"),p=i.querySelector("form"),d=i.querySelector(".shop-popup");i.addEventListener("click",function(e){e.target.classList.contains("shop-card__choose")&&(o=e.target.closest(".shop-card").id,d.classList.add("shop-popup_on"),console.log(document.getElementById("".concat(o)).querySelector(".shop-card__quan span").textContent)),e.target.classList.contains("shop-popup__close")&&(d.classList.remove("shop-popup_on"),p.querySelector(".form__server-error").textContent="",p.elements.address.value=""),e.target.classList.contains("shop-header__out")&&(localStorage.removeItem("userData"),window.location.reload())}),p.addEventListener("submit",function(e){l.buyGift(p.elements.name.value,p.elements.address.value,o).then(function(e){return e.ok&&(p.querySelector(".form__server-success").textContent="Покупка прошла успешно!"),e.json()}).then(function(e){var t=i.querySelector(".shop__stars-quantity span");e.error?p.querySelector(".form__server-error").textContent=e.error:(document.getElementById("".concat(o)).querySelector(".shop-card__quan span").textContent=e.giftsQuantity,t.textContent=e.starsToSpendQuantity)}).catch(function(e){p.querySelector(".form__server-error").textContent=e}),e.preventDefault()}),l.getUser().then(function(e){if(e.ok,500===e.status)throw new Error("Ошибка на сервере");if(404===e.status)throw new Error("Ошибка 404");if(401===e.status)throw new Error("Требуется аутентификация");return e.json()}).then(function(e){c.textContent=e.user.name,f.textContent=e.user.starsToSpendQuantity,localStorage.setItem("userData",JSON.stringify(r(r({},u),{},{starsToGiftQuantity:e.user.starsToGiftQuantity})))}).catch(function(e){}),l.getAllGifts().then(function(e){if(e.ok,500===e.status)throw new Error("Ошибка на сервере");if(404===e.status)throw new Error("Ошибка 404");if(401===e.status)throw new Error("Требуется аутентификация");return e.json()}).then(function(e){e.map(function(e){var t;a.insertAdjacentHTML("beforeend",(e=(t=e).quantity<1?"disabled":"",'<div style="'.concat(t.quantity<1?"border: none":"",'" class="shop-card"  id="').concat(t._id,'">\n        <div class="shop-card__back" style="').concat(t.quantity<1?"display: flex;":"display: none;",'">РАСКУПЛЕНО</div>\n        <div class="shop-card__wrapper">\n            <div class="shop-card__name">').concat(t.name,'</div>\n            <div class="shop-card__desc">').concat(t.description,'</div>\n            <div class="shop-card__quan">Осталось: <span> ').concat(t.quantity,'</span>шт.</div>\n        </div>\n        <div class="shop-card__wrapper">\n            <div class="shop-card__cost">').concat(t.cost+"*","</div>\n            <button ").concat(e,' class="shop-card__choose">Купить</button>\n        </div>\n    </div>')))})})}]);